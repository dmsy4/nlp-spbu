# Semantic Search

Скрипты для простейшей семантической поисковой системы с помощью векторного представления предложений/текстов на основе [FAISS](https://github.com/facebookresearch/faiss) и [HuggingFace](https://huggingface.co/models?pipeline_tag=feature-extraction) моделей


## Индексация `index.py`

Составляются эмбеддинги текстов из `--input-path` (каждый текст на новой строке), после чего создается простейший **IndexFlatL2** индекс, который сохраняется на диск `--save-path`.

## Поиск `search.py`

Возможны два варианта поиска:

-   Поиск по текстам из файла (каждый текст на новой строке), аргумент `--query-path`.
-   Поиск по текстам из CLI (каждый текст разделен символом `\n`), аргумент `--query-texts`.

Каждый query-текст векторизуется с помощью той же модели, что и при создании индекса, после чего индекс, созданный с помощью `index.py` загружается в память и производится векторный поиск. Если передан аргумент `--index-texts` (тексты, использованные для создания индекса), то помимо ID ближайших векторов к query запросам также выводятся сами текста.

## Пример использования

```
python3 search.py --query-texts "Новости о футболе" --index-texts news.txt -k 3


Query text: Новости о футболе
Nearest vector indexes: [8031 3484 9956], distances: [226.4159  232.30098 240.57141]
[idx 8031]: Чемпион России по футболу, московский ЦСКА, в первом туре стартовавшего в субботу, 30 июля, первенства страны на выезде сыграл вничью с махачкалинским «Анжи» — 0:0. Об этом сообщает официальный сайт Российской футбольной Премьер-лиги.Материалы по теме12:18 30 июля 2016«Ничего нового в нашем футболе мы не увидим»Невеселые размышления Александра Мостового о старте чемпионата РоссииЗа несколько часов до матча судебный пристав вручил нападающему московской команды Ласина Траоре постановление о возбуждении исполнительного производства.На старте сезона-2016/17 красно-синие не могут забить ни одного мяча. 23 июля в матче за Суперкубок страны армейцы со счетом 0:1 проиграли «Зениту».Ранее в субботу, петербуржцы не сумели одолеть «Локомотив» (0:0).
[idx 3484]: Лондонский футбольный клуб "Челси" сыграл вничью с чемпионом Англии "Манчестер Сити" в первом матче под руководством нового тренера - испанца Рафаэля Бенитеса. Встреча завершилась со счетом 0:0. "Манчестер Сити", который лидировал в английской премьер-лиге после предыдущего тура, опустился в турнирной таблице на второе место.В других матчах чемпионата Англии, состоявшихся 25 ноября, "Саутгемптон" выиграл у "Ньюкасла" (2:0), а "Тоттенхэм" взял верх над "Вест Хэмом" (3:1).После 13 туров первое место в премьер-лиге занимает "Манчестер Юнайтед", набравший 30 очков. 24 ноября "МЮ" победил "Куинс Парк Рейнджерс" (3:1). "Манчестер Сити", в активе которого 29 очков, занимает второе место. У "Челси" 25 очков, лондонцы расположились на четвертой позиции в турнирной таблице.
[idx 9956]: Питерский футбольный клуб «Зенит» на своем поле сыграл вничью с мадридским «Атлетико» в пятом туре группового этапа Лиги чемпионов. По ходу встречи «Атлетико» вел со счетом 1:0, однако гол футболиста мадридской команды Тоби Алдервейрелда в свои ворота на 74-й минуте принес «Зениту» ничью. Прямую трансляцию матча вел телеканал «НТВ Плюс Футбол».Материалы по теме18:52 26 ноября 2013«Зенит» — «Атлетико»Матч Лиги чемпионов: онлайн «Ленты.ру»В первом тайме голов забито не было. На 53-й минуте Адриан Лопес, воспользовавшись ошибкой защитников «Зенита», вышел один на один и открыл счет. На 74-й минуте Алдервейрелд, пытаясь прервать подачу Игоря Смольникова в штрафную, головой отправил мяч в собственные ворота.В пяти турах группового этапа «Зенит» набрал шесть очков. С этим результатом питерцы занимают второе место в группе. Лидирующий «Атлетико» набрал 13 очков и уже гарантировал себе выход в 1/8 финала с первого места. Третье место в группе занимает португальский «Порту», на счету которого четыре очка в четырех встречах. У венской «Аустрии» в четырех матчах только одно очко. Матч «Порту» — «Аустрия» пройдет поздно вечером 26 ноября.
```

```
python3 search.py --query-texts "Премьера фильма" --index-texts news.txt -k 3


Query text: Премьера фильма
Nearest vector indexes: [3121 2781 8566], distances: [221.36588 222.72447 226.34479]
[idx 3121]: В сети появился новый трейлер картины «Тарзан. Легенда». Фильм рассказывает о том, как освоившийся в Лондоне Тарзан возвращается в джунгли Африки, чтобы отстоять родные края в борьбе с алчными промышленникам. Главную роль сыграл Александр Скарсгард («Соломенные псы»). В ленте также снялись Кристоф Вальц, Сэмюэл Джексон. Картина выходит в прокат 30 июня.
[idx 2781]: В сети появился международный трейлер фильма «Иллюзия обмана 2». В сиквеле вновь снялись актеры из первой части — Джесси Айзенберг, Марк Руффало, Вуди Харрельсон, Айла Фишер, Дэвид Франко, Морган Фриман и Майкл Кейн. Режиссером выступил Джон М. Чу («Шаг вперед»).Картина выйдет в прокат 4 июля.
[idx 8566]: Канал Netflix опубликовал трейлер нового сериала «Люк Кейдж», снятого по мотивам комиксов Marvel. Он рассказывает о приключениях супергероя — бывшего преступника, который в результате медицинских экспериментов получает сверхъестественные способности и становится неуязвимым наемником. Главную роль сыграл Майкл Колтер. Премьера сериала состоится 30 сентября.
```
